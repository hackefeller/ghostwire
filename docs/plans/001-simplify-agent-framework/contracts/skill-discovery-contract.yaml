version: 1
name: skill-discovery-contract
summary: Deterministic scoped skill discovery and resolution contract.

policy:
  canonicalPath: ".agents/skills"
  scopeWalk:
    enabled: true
    start: "current-working-directory"
    end: "repository-root"
  precedence:
    - project-local-nearest
    - parent-scope-ascending
    - user-scope
    - system-scope
    - builtin
  collision:
    strategy: first-wins
    diagnostics: required

interfaces:
  discoverSkills:
    input:
      cwd: absolute-path
      repoRoot: absolute-path
      includeBuiltin: boolean
    output:
      sources:
        - kind: string
          rootPath: absolute-path
          precedenceRank: integer
      discovered:
        - id: string
          name: string
          description: string
          sourcePath: absolute-path
          scope: string

  resolveSkills:
    input:
      discovered:
        - id: string
          sourcePath: absolute-path
          scope: string
      policy:
        collision: first-wins
    output:
      skills:
        - id: string
          sourcePath: absolute-path
          scope: string
      collisions:
        - skillId: string
          winnerPath: absolute-path
          loserPath: absolute-path
          reason: string
      resolutionDigest: string

  exportResolvedSkills:
    input:
      resolvedSkillSetDigest: string
      format: manifest
    output:
      manifestSemantics: runtime-parity-required

invariants:
  - For identical filesystem inputs and cwd, resolution order is deterministic.
  - Duplicate IDs never appear in final skills output.
  - Every duplicate encounter emits a collision diagnostic event.
  - Exported manifest semantics match runtime resolved skill semantics.

nonGoals:
  - Dynamic network skill fetching.
  - Implicit fallback to legacy path conventions.
